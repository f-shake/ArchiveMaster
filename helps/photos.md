# 修复照片修改时间

照片时间修复工具旨在自动修正照片文件的修改时间，使其与EXIF元数据中的实际拍摄时间保持一致，解决因设备传输或后期处理导致的时间偏差问题，确保文件管理、排序和分类的准确性，特别适配JPG、HEIC、DNG等主流照片格式，通过多线程处理和智能时间容差机制，为摄影师和普通用户提供高效精准的照片时间修复方案。

## 功能特性

1. 照片时间修复：自动修正照片文件的修改时间为EXIF元数据中的拍摄时间
2. 多格式支持：支持JPG/JPEG/HEIF/HEIC/DNG等主流照片格式
3. 智能容差处理：仅修正时间差异超过设定阈值的文件（默认1秒）
4. 多线程加速：可配置线程数提升批量处理效率（1-16线程）

## 配置说明

1. 目录：选择需要修复照片时间的文件夹路径
2. 线程数：设置处理线程数量（1-16）平衡速度与系统负载/硬盘读写速度。机械硬盘建议设置为1或2，固态硬盘可酌情设置为更多线程。
3. 需处理文件后缀名：指定要扫描的照片格式（默认包含`jpg`、`jpeg`、`heif`、`heic`、`dng`）
4. 最长容忍差异时间：设置文件修改时间与EXIF时间的最大允许差值（秒），超过该值才会被修正

## 原理解析

该工具通过扫描目录下指定格式的照片文件，提取EXIF元数据中的拍摄时间信息（使用ExifHelper），当检测到文件系统记录的修改时间与EXIF时间差异超过用户设定的阈值时，自动将文件修改时间同步为EXIF时间值。采用多线程并发处理机制加速大批量文件操作，通过正则表达式匹配目标文件扩展名，最终实现专业摄影场景下照片文件时间的精准修复，确保文件管理系统的时序准确性。处理结果以列表形式展示，包含原始时间和EXIF时间的对比信息。

# 创建照片集合副本

创建照片集合副本工具旨在通过智能压缩和整理照片文件，有效减少存储空间占用，同时保持合理的图像质量，适用于需要批量优化照片存储的专业摄影师和普通用户。

## 功能特性

1. 智能压缩：自动压缩HEIC/HEIF/JPG等格式照片，可调整压缩质量和尺寸
2. 文件分类处理：支持根据文件类型选择是需要压缩（如早期低压缩比的图片类格式）还是直接复制（如文档类文件）
3. 目录结构优化：可自定义输出目录层级和命名规则
4. 多线程加速：支持多线程并行处理提升效率

## 配置说明

1. 目录设置：
   - 源目录：选择待处理的照片目录
   - 目标目录：设置输出目录位置
   - 最深目录层级：控制输出目录结构深度。该配置用于减少处理后的目录层级，使底层文件扁平化。例如，设置为2，相对路径为D1/D2/D3/D4/File.ext，则目标相对路径将改为D1/D2/D3-D4-File.ext
   - 跳过已存在文件：避免重复处理
   - 目标文件名：输出文件的名称，其中`{FileName}`表示不包含后缀的源文件名。该处配置不包含后缀，后缀将在处理后自动添加。
   - 目标文件夹名：输出的每个文件夹的名称，其中`{FolderName}`表示源文件夹的名称。
2. 文件筛选：
   - 匹配条件：设置筛选条件
   - 压缩后缀名：设置需要压缩的图片格式（默认HEIC/HEIF/JPG）
   - 复制后缀名：设置直接复制的文件格式（默认PDF/DOC等文档）
3. 压缩参数：
   - 最大长边/短边像素：控制图片缩放尺寸，当图像的长边像素数大于最大长边像素，或短边像素数大于最大短边像素时，将进行尺寸的调整。
   - JPEG质量：设置压缩质量（1-100）
   - 输出格式：指定压缩后的文件格式，一般使用`jpg`以获得较高的兼容性
   - 处理线程数：设置并行处理线程数（1-16）

## 原理解析

该工具通过扫描源目录，根据文件扩展名自动分类处理：对指定格式的图片使用`MagickImage`库进行尺寸缩放和质量压缩，文档类文件直接复制。采用多线程流水线处理（删除旧文件→压缩图片→复制文档），通过正则表达式匹配文件类型，最终生成优化后的目录结构。处理过程记录错误信息，确保操作可追溯。

# 照片地理信息写入

照片地理信息写入工具用于将GPS轨迹数据（GPX文件）中的地理位置信息自动匹配并写入照片的EXIF元数据中，解决户外摄影时相机未内置GPS或GPS数据缺失的问题，确保照片包含准确的地理位置信息。

## 功能特性

1. 智能时间匹配：通过照片拍摄时间与GPX轨迹时间自动匹配最佳位置点
2. 时间偏移校正：支持设置相机与GPS设备的时间差补偿
3. 容差控制：可调节最大时间容差阈值，精确控制匹配精度
4. 多格式支持：兼容HEIC/HEIF/JPG等主流照片格式

## 配置说明

1. 目录：选择待处理的照片文件夹
2. GPX文件：选择包含轨迹数据的GPX文件（支持多选）
3. 需处理文件后缀名：指定要处理的照片格式（默认HEIC/HEIF/JPG）
4. 最长时间差异：设置照片时间与GPS点的最大允许时间差。超过该时间差，被认为GPS位置不能代表该时刻相机所在位置，则不会被记录GPS坐标。
5. 相机时间偏移：校正相机与GPS设备的时间差。可切换“相机时间更快”或“GPS时间更快”。例如，设置“相机时间更快”，偏移为2分钟，则表示GPS时间（实际准确时间）为12:00时，相机时间为12:02。

## 原理解析

该工具通过解析GPX轨迹文件获取时间戳和GPS坐标点，同时提取照片EXIF中的拍摄时间，采用二分查找算法匹配时间最接近的轨迹点，在校验时间差符合设定容差后，将匹配成功的经纬度写入照片EXIF元数据，并可选修正文件修改时间，最终实现照片与地理位置的精准关联。